<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutor Dashboard - QR Gate</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 min-h-screen font-sans">
    <div id="loginSection" class="max-w-md mx-auto mt-20 p-6 bg-white rounded-3xl shadow-xl">
        <h2 class="text-2xl font-bold text-center mb-6 text-slate-800">Acceso para Tutores</h2>
        <input type="email" id="tutorEmail" placeholder="Correo electrónico" class="w-full p-4 mb-4 border rounded-xl">
        <input type="password" id="tutorPass" placeholder="Contraseña" class="w-full p-4 mb-6 border rounded-xl">
        <button onclick="loginTutor()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold">ENTRAR</button>
    </div>

    <div id="dashboardSection" class="hidden max-w-4xl mx-auto p-4">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-xl font-black text-blue-900">QR GATE <span class="text-blue-500">TUTOR</span></h1>
            <button onclick="location.reload()" class="text-red-500 font-bold text-sm">Cerrar Sesión</button>
        </header>

        <div class="mb-6">
            <p class="text-slate-500 text-sm mb-2 font-bold uppercase">Mis Hijos:</p>
            <div id="botonesHijos" class="flex gap-2 overflow-x-auto pb-2">
                </div>
        </div>

        <div id="perfilHijo" class="bg-white p-6 rounded-3xl shadow-lg mb-6 border-t-4 border-blue-500">
            <h2 id="nombreHijoSel" class="text-2xl font-black text-slate-800 uppercase text-center">Seleccione un alumno</h2>
            <p id="emailAvisoSel" class="text-center text-blue-600 text-sm"></p>
        </div>

        <div class="bg-white rounded-3xl shadow-lg overflow-hidden">
            <table class="w-full text-left">
                <thead class="bg-slate-50 text-slate-500 text-xs uppercase">
                    <tr>
                        <th class="p-4">Fecha</th>
                        <th class="p-4">Hora</th>
                        <th class="p-4">Estado</th>
                    </tr>
                </thead>
                <tbody id="tablaAsistencias"></tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbxW2eTmjTj3UtOXJph2qi_-fMwE-A-8AT1EMt7a9achh1o7heNjXn8ZDhAOCJtDLrkP/exec";
        let hijosData = [];

        async function loginTutor() {
            const email = document.getElementById('tutorEmail').value;
            const pass = document.getElementById('tutorPass').value;
            
            const resp = await fetch(`${API_URL}?action=loginTutor&email=${email}&password=${pass}`);
            const data = await resp.json();

            if (data.status === "success") {
                hijosData = data.hijos;
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('dashboardSection').classList.remove('hidden');
                renderizarBotones();
            } else {
                alert("Error: " + data.message);
            }
        }

        function renderizarBotones() {
            const contenedor = document.getElementById('botonesHijos');
            contenedor.innerHTML = "";
            hijosData.forEach(hijo => {
                const btn = document.createElement('button');
                btn.innerText = hijo.nombre;
                btn.className = "bg-white border-2 border-blue-200 px-6 py-3 rounded-full font-bold text-blue-600 shadow-sm hover:bg-blue-50 transition-all";
                btn.onclick = () => cargarDatosHijo(hijo);
                contenedor.appendChild(btn);
            });
        }

        async function cargarDatosHijo(hijo) {
            document.getElementById('nombreHijoSel').innerText = hijo.nombre;
            document.getElementById('emailAvisoSel').innerText = "Enviando avisos a: " + hijo.emailAviso;
            
            const resp = await fetch(`${API_URL}?action=getHijoAsistencias&idHijo=${hijo.id}`);
            const data = await resp.json();
            
            const tabla = document.getElementById('tablaAsistencias');
            tabla.innerHTML = data.asistencias.map(reg => `
                <tr class="border-b">
                    <td class="p-4 text-slate-600">${reg.fecha}</td>
                    <td class="p-4 font-bold text-slate-800">${reg.hora}</td>
                    <td class="p-4">
                        <span class="px-3 py-1 rounded-full text-xs font-bold ${reg.tipo === 'Entrada' ? 'bg-green-100 text-green-700' : 'bg-orange-100 text-orange-700'}">
                            ${reg.tipo.toUpperCase()}
                        </span>
                    </td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>