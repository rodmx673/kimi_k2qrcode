<script>
window.onload = () => {
    try {
        const s = localStorage.getItem('userSession');
        if (!s) return;
        
        const user = JSON.parse(s);
        if (!user?.rol) {
            localStorage.removeItem('userSession');
            return;
        }
        
        // Mostrar opción de logout
        const logoutBtn = document.createElement('button');
        logoutBtn.innerHTML = '🚪 Cerrar Sesión';
        logoutBtn.style.cssText = 'position:fixed; top:20px; right:20px; background:red; color:white; border:none; padding:10px; border-radius:5px; cursor:pointer; z-index:1000;';
        logoutBtn.onclick = () => {
            localStorage.removeItem('userSession');
            location.reload();
        };
        document.body.appendChild(logoutBtn);
        
        // Redirigir según rol CON RETRASO para poder ver botón
        setTimeout(() => {
            const redirectMap = {
                'Director': 'monitor-director.html',
                'Tutor': 'dashboard-tutor.html', 
                'Alumno': 'dashboard-alumno.html',
                'Docente': 'dashboard-docente.html'
            };
            
            const redirectTo = redirectMap[user.rol];
            if (redirectTo && confirm(`Bienvenido ${user.nombre} (${user.rol})\n\n¿Ir a tu dashboard?`)) {
                location.replace(redirectTo);
            }
        }, 1000);
        
    } catch {
        localStorage.removeItem('userSession');
    }
};
</script>