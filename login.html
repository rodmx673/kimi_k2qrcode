<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - QR Gate Skool</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 min-h-screen flex items-center justify-center p-4">
<div class="bg-white p-8 rounded-[2rem] shadow-2xl w-full max-w-md">
    <div class="text-center mb-8">
        <h1 class="text-3xl font-black text-blue-600 italic">QR GATE</h1>
        <p class="text-slate-400 font-bold uppercase text-[10px] tracking-widest">Ingreso al Sistema</p>
    </div>
    <form id="loginForm" class="space-y-4">
        <div>
            <label class="block text-xs font-black text-slate-500 mb-1 ml-1">EMAIL / USUARIO</label>
            <input type="email" id="email" required class="w-full p-4 bg-slate-100 rounded-2xl border-none focus:ring-2 focus:ring-blue-500 outline-none font-bold text-slate-700" placeholder="tu@email.com">
        </div>
        <div>
            <label class="block text-xs font-black text-slate-500 mb-1 ml-1">CONTRASEÑA</label>
            <input type="password" id="password" required class="w-full p-4 bg-slate-100 rounded-2xl border-none focus:ring-2 focus:ring-blue-500 outline-none font-bold text-slate-700" placeholder="••••••••">
        </div>
        <button type="submit" id="btnIngresar" class="w-full bg-blue-600 text-white font-black py-4 rounded-2xl shadow-lg hover:bg-blue-700 transition-all transform active:scale-95">INGRESAR</button>
    </form>
    <div class="mt-6 text-center"><a href="index.html" class="text-slate-400 text-xs font-bold hover:text-blue-600">← Volver al inicio</a></div>
</div>
<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbymZkiBvIebJJ8qIhW9J5YpEL_kVWqJo3UwaLbqQdav-xXMHbH2ahWqaLg3xtw2PF7P/exec";
document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const btn = document.getElementById('btnIngresar');
    const email = document.getElementById('email').value.trim().toLowerCase();
    const pass = document.getElementById('password').value;
    if (!email || !pass) return alert("Completa todos los campos");
    btn.innerText = "VERIFICANDO..."; btn.disabled = true;
    try {
        const res = await fetch(`${SCRIPT_URL}?action=login&email=${encodeURIComponent(email)}&password=${encodeURIComponent(pass)}`, {method:'GET',mode:'cors'});
        const data = await res.json();
        if (data.status === "success") {
            localStorage.setItem('userSession', JSON.stringify(data.user));
            location.replace({Director:'monitor-director.html',Tutor:'dashboard-tutor.html',Alumno:'dashboard-alumno.html',Docente:'dashboard-docente.html'}[data.user.rol]);
        } else {
            alert("❌ " + (data.message || "Credenciales incorrectas"));
            resetBtn(btn);
        }
    } catch (err) {
        console.error(err);
        alert("⚠️ Error de conexión");
        resetBtn(btn);
    }
    function resetBtn(b){ b.innerText = "INGRESAR"; b.disabled = false; }
});
</script>
</body>
</html>

<script>
// Auto-login para testing
window.onload = function() {
    const urlParams = new URLSearchParams(window.location.search);
    const autoLogin = urlParams.get('auto');
    
    if (autoLogin) {
        // Limpiar sesión anterior
        localStorage.removeItem('userSession');
        
        const testUsers = {
            'director': {email: 'newcoordinatorC', password: 'mexico86', rol: 'Director'},
            'tutor': {email: 'newtutor03@gmail.com', password: 'mexico86', rol: 'Tutor'},
            'alumno': {email: 'ramonv@gmail.com', password: 'mexico86', rol: 'Alumno'},
            'docente': {email: 'testdocente@test.com', password: 'test123', rol: 'Docente'}
        };
        
        const user = testUsers[autoLogin];
        if (user) {
            // Rellenar formulario automáticamente
            document.getElementById('email').value = user.email;
            document.getElementById('password').value = user.password;
            
            // Mostrar mensaje
            setTimeout(() => {
                alert(`Auto-login como ${user.rol}\nEmail: ${user.email}\nPassword: ${user.password}`);
                document.querySelector('button[type="submit"]').click();
            }, 500);
        }
    }
};
</script>